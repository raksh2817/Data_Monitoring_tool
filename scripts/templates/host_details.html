{% extends "base.html" %}
{% block title %}{{ host.host_name }} - Host Details{% endblock %}
{% block content %}
<div style="margin-bottom: 2rem;"><a href="/dashboard" style="color: #3498db; text-decoration: none;">â† Back to Dashboard</a></div>

<div class="auto-refresh">ğŸ”„ Auto-refresh enabled (every 30 seconds) | Last updated: {{ current_time.strftime('%Y-%m-%d %H:%M:%S') }}</div>

<div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h1 style="margin: 0;">{{ host.host_name }}</h1>
        <span class="status {{ host.status }}" style="font-size: 1rem; padding: 0.5rem 1rem;">{% if host.status == 'online' %}ğŸŸ¢{% elif host.status == 'warning' %}ğŸŸ¡{% else %}ğŸ”´{% endif %} {{ host.status }}</span>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; color: #7f8c8d;">
        <div><strong>Operating System:</strong><br>{{ host.os_name }} {{ host.os_version }}</div>
        <div><strong>Last Seen:</strong><br>{% if host.last_seen %}{{ host.last_seen.strftime('%Y-%m-%d %H:%M:%S') }}{% else %}Never{% endif %}</div>
        <div><strong>Created:</strong><br>{{ host.created_at.strftime('%Y-%m-%d') }}</div>
        <div><strong>Host ID:</strong><br>{{ host.host_id }}</div>
    </div>
</div>

<h2 style="margin-bottom: 1rem;">Recent Metrics (Last 24 Hours)</h2>

{% if metrics %}
<div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
    <table>
        <thead><tr><th>Time</th><th>CPU</th><th>Memory</th><th>Disk</th><th>Memory (MB)</th><th>Disk (GB)</th></tr></thead>
        <tbody>
            {% for metric in metrics[:20] %}
            <tr>
                <td class="text-muted">{{ metric.collected_at.strftime('%H:%M:%S') }}</td>
                <td><span style="{% if metric.cpu_pct >= 90 %}color: #e74c3c;{% elif metric.cpu_pct >= 70 %}color: #f39c12;{% else %}color: #2ecc71;{% endif %} font-weight: bold;">{{ "%.1f"|format(metric.cpu_pct) }}%</span></td>
                <td><span style="{% if metric.mem_pct >= 90 %}color: #e74c3c;{% elif metric.mem_pct >= 70 %}color: #f39c12;{% else %}color: #2ecc71;{% endif %} font-weight: bold;">{{ "%.1f"|format(metric.mem_pct) }}%</span></td>
                <td><span style="{% if metric.disk_pct >= 90 %}color: #e74c3c;{% elif metric.disk_pct >= 70 %}color: #f39c12;{% else %}color: #2ecc71;{% endif %} font-weight: bold;">{{ "%.1f"|format(metric.disk_pct) }}%</span></td>
                <td class="text-muted">{% if metric.mem_used_mb and metric.mem_total_mb %}{{ (metric.mem_used_mb / 1024)|int }} / {{ (metric.mem_total_mb / 1024)|int }} GB{% else %}N/A{% endif %}</td>
                <td class="text-muted">{% if metric.disk_used_gb and metric.disk_total_gb %}{{ "%.1f"|format(metric.disk_used_gb) }} / {{ "%.1f"|format(metric.disk_total_gb) }} GB{% else %}N/A{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <p class="text-muted text-center" style="margin-top: 1rem;">Showing last 20 data points ({{ metrics|length }} total in last 24h)</p>
</div>
{% else %}
<div class="empty-state"><h3>No Metrics Available</h3><p>This host hasn't reported any metrics in the last 24 hours</p></div>
{% endif %}

<h2 style="margin-bottom: 1rem;">Recent Alerts</h2>

{% if alerts %}
<table>
    <thead><tr><th>Status</th><th>Severity</th><th>Alert Type</th><th>Message</th><th>Time</th></tr></thead>
    <tbody>
        {% for alert in alerts %}
        <tr>
            <td><span class="alert-status {{ alert.status }}">{% if alert.status == 'open' %}ğŸš¨ Open{% elif alert.status == 'acknowledged' %}âš ï¸ Acknowledged{% else %}âœ… Resolved{% endif %}</span></td>
            <td><span class="severity {{ alert.severity }}">{{ alert.severity }}</span></td>
            <td>{{ alert.check_name }}</td>
            <td style="max-width: 400px;">{{ alert.message }}</td>
            <td class="text-muted">{% if alert.minutes_ago < 60 %}{{ alert.minutes_ago }}m ago{% elif alert.minutes_ago < 1440 %}{{ (alert.minutes_ago / 60)|int }}h ago{% else %}{{ (alert.minutes_ago / 1440)|int }}d ago{% endif %}<br><small>{{ alert.triggered_at.strftime('%Y-%m-%d %H:%M') }}</small></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="empty-state"><h3>No Alerts</h3><p>This host has no recent alerts ğŸ‰</p></div>
{% endif %}

<div style="margin-top: 2rem; text-align: center;"><a href="/dashboard" style="color: #3498db; text-decoration: none;">â† Back to Dashboard</a></div>
{% endblock %}